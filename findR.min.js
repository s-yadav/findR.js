/*
findR.js v 0.6.0
Author: sudhanshu yadav
Copyright (c) 2013 Sudhanshu Yadav, released under the MIT license.
www.ignitersworld.com
*/
(function(e,t,n){var r={ctrl:false,initialized:false,elements:[],binded:false,selector:""},i=function(e){if(!r[e]){r[e]=t.getElementById(e)}return r[e]};var s=function(t){s.fn.eventAssigner(e,"load",function(){s.fn.init(t)})};s.fn=s.prototype={init:function(e){if(!e||e==t){e=t.getElementsByTagName("body")[0]}else{e=t.getElementById(e)}if(!e)return;this.selector=e;r.elements.push(e);if(!r.binded){r.binded=true;this.addHtml();this.bindKeyEvent()}this.eventAssigner(e,"click",function(t){r.selector=e;t.stopPropagation()})},eventAssigner:function(t,n,r){if(e.addEventListener){t.addEventListener(n,r,false)}else{t.attachEvent("on"+n,r)}},eventRemove:function(t,n,r){if(e.removeEventListener){t.removeEventListener(n,r)}else{t.detachEvent("on"+n,r)}},bindKeyEvent:function(){var e=i("findTextbx"),n=function(e){if(!r.ctrl||r.selector=="")return;e.preventDefault();var t=e.keyCode;if(t==70){s.fn.openToolbar()}if(t==78){s.fn.focusNext()}if(t==80){s.fn.focusPrev()}if(t==82){s.fn.replaceMethod()}};this.eventAssigner(t,"keydown",n);this.eventAssigner(t,"keydown",function(e){if(e.keyCode==17){r.ctrl=true}});this.eventAssigner(t,"keyup",function(e){if(e.keyCode==17){r.ctrl=false}});this.eventAssigner(e,"keyup",function(e){if(e.keyCode!=17&&e.keyCode!=18){s.fn.findTEvent()}});this.eventAssigner(i("replaceButn"),"click",function(){s.fn.replaceMethod()});this.eventAssigner(i("replaceAllButn"),"click",function(){s.fn.replaceMethod(true)});this.eventAssigner(i("closeFrToolbar"),"click",function(e){i("frToolbar").style.display="none";i("frToolbarForm").reset();r.initialized=false;s.fn.unwrapTextNodes();e.stopPropagation()})},openToolbar:function(){var e=i("frToolbar");e.style.display="block";r.initialized=true;this.wrapTextNodes()},wrapTextNodes:function(){function n(r){var i=r.childNodes;if(i.length>0){for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u.id=="frToolbar"){continue}else if(u.nodeType==Node.TEXT_NODE){if(e.indexOf(u)==-1){e.push(u);var a=u.parentNode;if(a.className!="findRTextWrapper"&&a.parentNode.className!="findRTextWrapper"){var f=t.createElement("span");f.setAttribute("class","findRTextWrapper");f.textContent=u.textContent;a.insertBefore(f,u);a.removeChild(u)}}}else{n(u)}}}}var e=[];n(r.selector);this.findRTextWrapper=t.getElementsByClassName("findRTextWrapper")},unwrapTextNodes:function(){var e=this.selectedElm,n=this.findRTextWrapper,r=function(e){var n=e.parentNode,r=t.createTextNode(e.innerHTML);n.insertBefore(r,e);n.removeChild(e)};while(e.length!=0){r(e[0])}while(n.length!=0){r(n[0])}},findTEvent:function(){if(r.ctrl)return;var e=i("findTextbx").value,n=i("regexSearch").checked,s=i("matchCase").checked,o=s?"g":"gi",u;e=n?e:this.escapeRegExp(e);try{u=new RegExp("&[^;]+;|("+e+")",o)}catch(a){u=new RegExp("()",o)}var f=this.findRTextWrapper,l=/<span class="findRhighlighted">(.*?)\<\/span>/g,c=/<span class="findRhighlighted findRhighlightedFocused">(.*?)<\/span>/g;for(var h=0,p=f.length;h<p;h++){var d=f[h],v=d.innerHTML;v=v.replace(l,"$1");v=v.replace(c,"$1");if(e==""){d.innerHTML=v;continue}v=v.replace(u,function(e,t){return e==t?'<span class="findRhighlighted">'+t+"</span>":e});d.innerHTML=v}var m=t.getElementsByClassName("findRhighlighted");if(m.length!=0){m[0].className="findRhighlighted findRhighlightedFocused"}this.selectedElm=m;this.focusedElm=t.getElementsByClassName("findRhighlightedFocused");this.focusindex=0;this.scrollToFocus()},replaceMethod:function(e){var n=i("replaceTextbx").value;if(e){var r=Array.prototype.slice.apply(this.selectedElm)}else{var r=[this.focusedElm[0]];this.focusNext()}while(r.length!=0){var s=r[0].parentNode,o=t.createTextNode(n);s.insertBefore(o,r[0]);s.removeChild(r[0]);r.splice(0,1)}},focusNext:function(){if(this.selectedElm.length!=0){var e=this.selectedElm,t=this.focusedElm[0],n=this.getIndexElm(e,t);if(n==e.length-1){n=-1}t.className="findRhighlighted";e[n+1].className="findRhighlighted findRhighlightedFocused";this.scrollToFocus()}},focusPrev:function(){if(this.selectedElm.length!=0){var e=this.selectedElm,t=this.focusedElm[0],n=this.getIndexElm(e,t);if(n==0){n=e.length}t.className="findRhighlighted";e[n-1].className="findRhighlighted findRhighlightedFocused";this.scrollToFocus()}},getIndexElm:function(e,t){for(var n=0,r=e.length;n<r;n++){if(e[n]==t)return n}return-1},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},findPos:function(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return[t]}},scrollToFocus:function(){var t=this.focusedElm[0];if(t){var n=this.findPos(t);e.scroll(0,n)}},addHtml:function(){if(!i("frToolbar")){var e=t.createElement("div");e.innerHTML='<form id="frToolbarForm">Find :<input type="textbox" id="findTextbx"/>    Replace:<input type="textbox" id="replaceTextbx"/>    Match Cases:<input type="checkbox" id="matchCase" checked="checked" />    Regex Search:<input type="checkbox" id="regexSearch"  /> <input type="button" id="replaceButn" value="Find And Replace"/>   <input type="button" id="replaceAllButn" value="Replace All"/>    <span id="closeFrToolbar">Ã—</span></form>';e.id="frToolbar";e.setAttribute("class","findRtoolbar");t.getElementsByTagName("body")[0].appendChild(e)}}};e.findR=s})(window,document)