/*
findR.js v 0.5.0
Author: sudhanshu yadav
Copyright (c) 2013 Sudhanshu Yadav, released under the MIT license.
www.ignitersworld.com
*/
(function(e,t,n){var r={cntrlPrsd:false,ctrl:false,alt:false,initialized:false,binded:false,selector:""},i=function(e){if(!r[e]){r[e]=t.getElementById(e)}return r[e]};var s=function(t){s.fn.eventAssigner(e,"load",function(){s.fn.init(t)})};s.fn=s.prototype={init:function(e){if(!e||e==t){e=t.getElementsByTagName("body")[0]}else{e=t.getElementById(e)}if(!e)return;this.selector=e;if(!r.binded){r.binded=true;this.addHtml();this.bindKeyEvent()}this.eventAssigner(e,"click",function(){if(!r.initialized){r.initialized=true;r.selector=e}})},eventAssigner:function(t,n,r){if(e.addEventListener){t.addEventListener(n,r,false)}else{t.attachEvent(n,r)}},eventRemove:function(t,n,r){if(e.removeEventListener){t.removeEventListener(n,r)}else{t.detachEvent(n,r)}},bindKeyEvent:function(){var e=i("findTextbx"),n=function(e){if(!r.cntrlPrsd||!r.selector)return;e.preventDefault();var t=e.keyCode;if(t==70){s.fn.openToolbar()}if(t==78){s.fn.focusNext()}if(t==80){s.fn.focusPrev()}if(t==82){s.fn.replaceMethod()}};this.eventAssigner(t,"keydown",n);this.eventAssigner(t,"keydown",function(e){if(e.keyCode==17){r.ctrl=true}else if(e.keyCode==18){r.alt=true}r.cntrlPrsd=r.ctrl&&r.alt});this.eventAssigner(t,"keyup",function(e){if(e.keyCode==17){r.ctrl=false}else if(e.keyCode==18){r.alt=false}r.cntrlPrsd=r.ctrl&&r.alt});this.eventAssigner(e,"keyup",function(e){if(e.keyCode!=17&&e.keyCode!=18){s.fn.findTEvent()}});this.eventAssigner(i("replaceButn"),"click",function(){s.fn.replaceMethod()});this.eventAssigner(i("replaceAllButn"),"click",function(){s.fn.replaceMethod(true)});this.eventAssigner(i("closeFrToolbar"),"click",function(){i("frToolbar").style.display="none";r.initialized=false})},openToolbar:function(){var e=i("frToolbar");e.style.display="block";this.wrapTextNodes()},wrapTextNodes:function(){function n(r){var i=r.childNodes;if(i.length>0){for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u.id=="frToolbar"){continue}else if(u.nodeType==Node.TEXT_NODE){if(e.indexOf(u)==-1){e.push(u);if(u.parentNode.className!="findRTextWrapper"&&u.parentNode.parentNode.className!="findRTextWrapper"){var a=t.createElement("span");a.setAttribute("class","findRTextWrapper");a.textContent=u.textContent;u.parentNode.insertBefore(a,u);u.parentNode.removeChild(u)}}}else{n(u)}}}}var e=[];n(r.selector);this.findRTextWrapper=t.getElementsByClassName("findRTextWrapper")},findTEvent:function(){if(r.cntrlPrsd)return;var e=i("findTextbx").value,n=i("regexSearch").checked,s=i("matchCase").checked,o=s?"g":"gi",u;e=n?e:this.escapeRegExp(e);try{u=new RegExp("&[^;]+;|("+e+")",o)}catch(a){u=new RegExp("()",o)}var f=this.findRTextWrapper,l=/<span class="findRhighlighted">(.*?)\<\/span>/g,c=/<span class="findRhighlighted findRhighlightedFocused">(.*?)<\/span>/g;for(var h=0,p=f.length;h<p;h++){var d=f[h],v=d.innerHTML;v=v.replace(l,"$1");v=v.replace(c,"$1");if(e==""){d.innerHTML=v;continue}v=v.replace(u,function(e,t){return e==t?'<span class="findRhighlighted">'+t+"</span>":e});d.innerHTML=v}var m=t.getElementsByClassName("findRhighlighted");if(m.length!=0){m[0].className="findRhighlighted findRhighlightedFocused"}this.selectedElm=m;this.focusedElm=t.getElementsByClassName("findRhighlightedFocused");this.scrollToFocus()},replaceMethod:function(e){var t=i("replaceTextbx").value;if(e){var n=this.selectedElm}else{var n=this.focusedElm}for(var r=0,s=n.length;r<s;r++){n[r].innerHTML=t}if(!e){this.focusNext()}},focusNext:function(){var e=this.selectedElm,n=this.focusedElm[0],r=this.getIndexElm(e,n);if(r==e.length-1){r=-1}n.className="findRhighlighted";e[r+1].className="findRhighlighted findRhighlightedFocused";this.focusedElm=t.getElementsByClassName("findRhighlightedFocused");this.scrollToFocus()},focusPrev:function(){var e=this.selectedElm,n=this.focusedElm[0],r=this.getIndexElm(e,n);if(r==0){r=e.length}n.className="findRhighlighted";e[r-1].className="findRhighlighted findRhighlightedFocused";this.focusedElm=t.getElementsByClassName("findRhighlightedFocused");this.scrollToFocus()},getIndexElm:function(e,t){for(var n=0,r=e.length;n<r;n++){if(e[n]==t)return n}return-1},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},findPos:function(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return[t]}},scrollToFocus:function(){var t=this.focusedElm[0];if(t){var n=this.findPos(t);e.scroll(0,n)}},addHtml:function(){if(!i("frToolbar")){var e=t.createElement("div");e.innerHTML='Find :<input type="textbox" id="findTextbx"/>    Replace:<input type="textbox" id="replaceTextbx"/>    Match Cases:<input type="checkbox" id="matchCase" checked="checked" />    Regex Search:<input type="checkbox" id="regexSearch"  /> <input type="button" id="replaceButn" value="Find And Replace"/>   <input type="button" id="replaceAllButn" value="Replace All"/>    <span id="closeFrToolbar">×</span> ';e.id="frToolbar";e.setAttribute("class","findRtoolbar");t.getElementsByTagName("body")[0].appendChild(e)}}};e.findR=s})(window,document)