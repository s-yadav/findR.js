/*
	findR.js v 0.6.0 (jquery version for findR.js)
	Author: sudhanshu yadav
	Copyright (c) 2013 Sudhanshu Yadav, released under the MIT license.
	www.ignitersworld.com
*/
(function(e,t,n){var r={ctrl:false,initialized:false,binded:false,selector:""},i=function(e){if(!r[e]){r[e]=$(e)}return r[e]};var s=function(e){$(function(){s.fn.init(e)})};s.fn=s.prototype={init:function(e){r.body=$("body");r.document=$(t);if(!e||e==t){e=r.body}else{e=$(e)}if(!e)return;this.selector=e;if(!r.binded){r.binded=true;this.addHtml();this.bindKeyEvent()}e.bind("click",function(t){r.selector=e;t.stopPropagation()})},bindKeyEvent:function(){var e=i("#findTextbx"),t=function(e){if(!r.ctrl||r.selector=="")return;e.preventDefault();var t=e.keyCode;if(t==70){s.fn.openToolbar()}if(t==78){s.fn.focusNext()}if(t==80){s.fn.focusPrev()}if(t==82){s.fn.replaceMethod()}};r.document.bind("keydown",t);r.document.bind("keydown",function(e){if(e.keyCode==17){r.ctrl=true}});r.document.bind("keyup",function(e){if(e.keyCode==17){r.ctrl=false}});e.bind("keyup",function(e){if(e.keyCode!=17&&e.keyCode!=18){s.fn.findTEvent()}});i("#replaceButn").bind("click",function(){s.fn.replaceMethod()});i("#replaceAllButn").bind("click",function(){s.fn.replaceMethod(true)});i("#closeFrToolbar").bind("click",function(e){i("#frToolbar")[0].style.display="none";i("#frToolbarForm")[0].reset();r.initialized=false;s.fn.unwrapTextNodes();e.stopPropagation()})},openToolbar:function(){var e=i("#frToolbar");e[0].style.display="block";r.initialized=true;this.wrapTextNodes()},wrapTextNodes:function(){function n(r){var i=r.childNodes;if(i.length>0){for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u.id=="frToolbar"){continue}else if(u.nodeType==Node.TEXT_NODE){if(e.indexOf(u)==-1){e.push(u);var a=u.parentNode;if(a.className!="findRTextWrapper"&&a.parentNode.className!="findRTextWrapper"){var f=t.createElement("span");f.setAttribute("class","findRTextWrapper");f.textContent=u.textContent;a.insertBefore(f,u);a.removeChild(u)}}}else{n(u)}}}}var e=[];n(r.selector[0]);this.findRTextWrapper=$(".findRTextWrapper")},unwrapTextNodes:function(){var e=this.selectedElm,n=this.findRTextWrapper,r=function(e){var n=e.parentNode,r=t.createTextNode(e.innerHTML);n.insertBefore(r,e);n.removeChild(e)};while(e.length!=0){r(e[e.length-1]);e.length--}while(n.length!=0){r(n[n.length-1]);n.length--}},findTEvent:function(){if(r.ctrl)return;var e=i("#findTextbx").val(),t=i("#regexSearch")[0].checked,n=i("#matchCase")[0].checked,s=n?"g":"gi",o;e=t?e:this.escapeRegExp(e);try{o=new RegExp("&[^;]+;|("+e+")",s)}catch(u){o=new RegExp("()",s)}var a=this.findRTextWrapper,f=/<span class="findRhighlighted">(.*?)\<\/span>/g,l=/<span class="findRhighlighted findRhighlightedFocused">(.*?)<\/span>/g;for(var c=0,h=a.length;c<h;c++){var p=a[c],d=p.innerHTML;d=d.replace(f,"$1");d=d.replace(l,"$1");if(e==""){p.innerHTML=d;continue}d=d.replace(o,function(e,t){return e==t?'<span class="findRhighlighted">'+t+"</span>":e});p.innerHTML=d}var v=$(".findRhighlighted");if(v.length!=0){v[0].className="findRhighlighted findRhighlightedFocused"}this.selectedElm=v;this.focusedElm=$(".findRhighlightedFocused");this.scrollToFocus()},replaceMethod:function(e){var n=i("#replaceTextbx").val();if(e){var r=this.selectedElm}else{var r=this.focusedElm}for(var s=0,o=r.length;s<o;s++){var u=r[s].parentNode,a=t.createTextNode(n);u.insertBefore(a,r[s]);u.removeChild(r[s])}if(!e){this.focusNext()}this.selectedElm=$(".findRhighlighted")},focusNext:function(){var e=this.selectedElm,t=this.focusedElm[0],n=e.index(t);if(e.length==0)return;if(n==e.length-1){console.log(n);n=-1}t.className="findRhighlighted";e[n+1].className="findRhighlighted findRhighlightedFocused";this.focusedElm=$(".findRhighlightedFocused");this.scrollToFocus()},focusPrev:function(){var e=this.selectedElm,t=this.focusedElm[0],n=e.index(t);if(e.length==0)return;if(n==0){console.log(n);n=e.length}t.className="findRhighlighted";e[n-1].className="findRhighlighted findRhighlightedFocused";this.focusedElm=$(".findRhighlightedFocused");this.scrollToFocus()},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},findPos:function(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return[t]}},scrollToFocus:function(){var t=this.focusedElm[0];if(t){var n=this.findPos(t);e.scroll(0,n)}},addHtml:function(){if($("#frToolbar").length==0){var e=$('<div id="frToolbar" class="findRtoolbar"></div>');e.html('<form id="frToolbarForm">Find :<input type="textbox" id="findTextbx"/>    Replace:<input type="textbox" id="replaceTextbx"/>    Match Cases:<input type="checkbox" id="matchCase" checked="checked" />    Regex Search:<input type="checkbox" id="regexSearch"  /> <input type="button" id="replaceButn" value="Find And Replace"/>   <input type="button" id="replaceAllButn" value="Replace All"/>    <span id="closeFrToolbar">Ã—</span></form>');r.body.append(e)}}};e.findR=s})(window,document)